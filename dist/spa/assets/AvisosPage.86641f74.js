import{Q as H}from"./QList.7dac5c91.js";import{Q as z}from"./QSpace.5039b404.js";import{Q as W,a as M}from"./QBar.f6cb8648.js";import{bq as B,cI as O,aT as v,ab as Q,bo as e,f as t,ak as C,W as d,ae as s,ad as x,ac as L,S as F,r as m,c as J,w as Y,o as R,c6 as Z,cl as G,c4 as K,cj as X,a as ee,cc as ae,aZ as P,F as S,c8 as te,c7 as se,c9 as j,ck as D,ai as oe,cb as ne}from"./index.fe61ee2b.js";import{u as ie,Q as re,a as le,b as ce}from"./avisos.3f045095.js";import{Q as ue}from"./QPage.e3a32904.js";import{C as de}from"./ClosePopup.d90c1ebd.js";import{u as ve}from"./use-quasar.6e3d8175.js";import{d as me,e as pe,a as fe}from"./format.759a650d.js";import{_ as I}from"./plugin-vue_export-helper.21dcd24c.js";import{Q as ge}from"./QPagination.7bf5b5ea.js";import{Q as V,a as be}from"./QTable.6ec200bc.js";import"./QSelect.27ff7cce.js";const _e={class:"text-caption"},we={key:0,class:"text-caption"},ye={class:"text-caption"},xe={__name:"TarjetaAviso",props:{aviso:{type:Object,required:!0}},setup(l){const b=p=>{switch(p.estado){case"Nueva":return p.asignado?"status-asignado":"status-nuevo";case"En Proceso":return"status-proceso";case"Visitado / sin terminar":return"status-proceso";case"Terminado":return"status-terminado";case"Supervisar":return"status-supervisar";default:return"status-proceso"}};return(p,f)=>B((v(),Q(fe,{clickable:"",class:"aviso"},{default:e(()=>[t(me,null,{default:e(()=>[t(pe,null,{default:e(()=>[C(d(l.aviso.codigo+" - "+l.aviso.equipo),1)]),_:1}),s("span",_e,d(l.aviso.creado),1),l.aviso.tecnico!=""?(v(),x("span",we,"Asignado: "+d(l.aviso.tecnico),1)):L("",!0),s("span",ye,d(l.aviso.descripcion),1),s("span",{class:F(["text-caption aviso-status",b(l.aviso)])},d(l.aviso.estado=="Nueva"?l.aviso.asignado?"T\xE9cnico asignado":"Pendiente asignaci\xF3n":l.aviso.estado=="Visitado / sin terminar"?"En proceso":l.aviso.estado=="Supervisar"?"Cerrado":l.aviso.estado),3)]),_:1})]),_:1})),[[O]])}};var Qe=I(xe,[["__scopeId","data-v-7c629475"]]);const ke={class:"row justify-center q-mt-md",style:{width:"100%"}},Ee=["onClick"],he={__name:"TablaAvisos",props:{items:{type:Array,required:!0},totalItems:{type:Number,required:!0},posicion:{type:Number,required:!0}},emits:["abrir","filtrarEstado","paginar"],setup(l,{emit:b}){const p=m(""),f=l,c=b,k=n=>n.informes&&n.informes.length>0?n.informes[n.informes.length-1].fin:n.creado,g=m({page:f.posicion,rowsPerPage:20}),_=J(()=>Math.ceil(f.totalItems/g.value.rowsPerPage)),w=[{name:"est",label:"Estado",field:"estado",align:"center"},{name:"cod",label:"C\xF3digo",field:"codigo",align:"center"},{name:"eqp",label:"Servicio",field:"equipo",align:"center"},{name:"cre",label:"Creado",field:"creado",align:"center"},{name:"act",label:"actualizado",align:"center"},{name:"tec",label:"T\xE9cnico asignado",field:"tecnico",align:"center"},{name:"ver"}],E=n=>{c("abrir",n)},y=n=>{switch(n){case 0:c("filtrarEstado",0);break;case 1:c("filtrarEstado",1);break;case 2:c("filtrarEstado",2);break;case 3:c("filtrarEstado",3);break}},T=n=>{c("paginar",n)},h=n=>{switch(n.estado){case"Nueva":return n.asignado?"status-asignado":"status-nuevo";case"En Proceso":return"status-proceso";case"Visitado / sin terminar":return"status-proceso";case"Terminado":return"status-terminado";case"Supervisar":return"status-supervisar";default:return"status-proceso"}};return Y(()=>f.posicion,n=>{g.value.page=n}),R(()=>console.log(f.posicion)),(n,u)=>(v(),Q(be,{rows:f.items,columns:w,"row-key":"name",filter:p.value,"hide-pagination":"",pagination:g.value,"no-data-label":"No hay datos para mostrar.",flat:"",class:"tabla"},{"top-right":e(()=>[t(z),t(Z,{dense:"",debounce:"300",color:"primary",modelValue:p.value,"onUpdate:modelValue":u[0]||(u[0]=a=>p.value=a)},{append:e(()=>[t(G,{name:"search"})]),_:1},8,["modelValue"])]),"top-left":e(()=>[s("button",{class:"boton-tabla azul",onClick:u[1]||(u[1]=a=>y(0))},"Todos"),s("button",{class:"boton-tabla naranja",onClick:u[2]||(u[2]=a=>y(1))},"Nuevos"),s("button",{class:"boton-tabla verde",onClick:u[3]||(u[3]=a=>y(2))},"En proceso"),s("button",{class:"boton-tabla gris",onClick:u[4]||(u[4]=a=>y(3))},"Cerrados")]),bottom:e(()=>[s("div",ke,[t(ge,{modelValue:g.value.page,"onUpdate:modelValue":[u[5]||(u[5]=a=>g.value.page=a),T],"direction-links":"",color:"grey-8","active-color":"primary",flat:"",max:_.value,"boundary-numbers":"true","max-pages":10,ellipses:""},null,8,["modelValue","max"])])]),"body-cell-est":e(a=>[t(V,{props:a},{default:e(()=>[s("button",{class:F(["text-caption aviso-status",h(a.row)])},d(a.row.estado=="Nueva"?a.row.asignado?"T\xE9cnico asignado":"Pendiente asignaci\xF3n":a.row.estado=="Visitado / sin terminar"?"En proceso":a.row.estado=="Supervisar"?"Cerrado":a.row.estado),3)]),_:2},1032,["props"])]),"body-cell-act":e(a=>[t(V,{props:a},{default:e(()=>[C(d(k(a.row)),1)]),_:2},1032,["props"])]),"body-cell-ver":e(a=>[t(V,null,{default:e(()=>[s("button",{class:"boton-tabla azul",onClick:N=>E(a.row)},"Detalles",8,Ee)]),_:2},1024)]),_:1},8,["rows","filter","pagination"]))}};var Ce=I(he,[["__scopeId","data-v-b64ebaf4"]]);const Te={id:"tabla-avisos"},Ae={id:"lista-avisos"},Pe={class:"text-h5"},Se={class:"text-overline"},Ve={class:"caption-text"},Ie={key:0},Ne={class:"text-body2 informe-titulo"},$e={class:"text-caption informe-texto"},qe={__name:"AvisosPage",setup(l){const b=ve(),p=K(),f=X();ie();const c=m([]),k=m(0),g=m(20),_=m(1),w=m(!1),E=m(!1),y=m({}),T=m([]),h=m(0),n=r=>{b.sessionStorage.setItem("aviso",JSON.stringify(r)),p.push(f.path+"/"+r.id)},u=r=>{h.value=r,_.value=1,c.value=[],a()},a=async()=>{if(!w.value){b.loading.show(),w.value=!0;try{const r=await ae.get("/avisos.php?pag="+_.value+"&estado="+h.value,{withCredentials:!0});console.log("Avisos: ",r.data),r.data.success&&(k.value=r.data.message.total,c.value=[...c.value,...r.data.message.avisos],c.value=c.value.sort((i,o)=>new Date(o.creado_js)-new Date(i.creado_js)))}catch(r){console.log("Error:",r)}w.value=!1,b.loading.hide()}},N=r=>{_.value=r,c.value=[],a()},$=()=>{const r=window.scrollY+window.innerHeight,i=document.documentElement.scrollHeight;!w.value&&r>=i-10&&g.value<=numEquipos.value&&(_.value+=1,g.value+=20,a())};return R(()=>{window.innerWidth<820&&window.addEventListener("scroll",$),a()}),ee(()=>{window.innerWidth<820&&window.removeEventListener("scroll",$)}),(r,i)=>(v(),Q(ue,{class:"q-pa-md"},{default:e(()=>[i[6]||(i[6]=s("div",{class:"cabecera"},[s("span",{class:"text-h6"},"Sus avisos"),s("span",{class:"text-subtitle2"},"Visualice sus partes de trabajo generados")],-1)),s("div",Te,[t(Ce,{items:c.value,totalItems:k.value,posicion:_.value,onAbrir:n,onFiltrarEstado:i[0]||(i[0]=o=>u(o)),onPaginar:i[1]||(i[1]=o=>N(o))},null,8,["items","totalItems","posicion"])]),s("div",Ae,[t(H,{bordered:"",separator:""},{default:e(()=>[(v(!0),x(S,null,P(c.value,o=>(v(),Q(Qe,{key:o.id,aviso:o,onClick:q=>n(o)},null,8,["aviso","onClick"]))),128))]),_:1})]),t(ne,{modelValue:E.value,"onUpdate:modelValue":i[2]||(i[2]=o=>E.value=o),class:"dialogo"},{default:e(()=>[t(te,null,{default:e(()=>[t(W,{class:"barra-titulo"},{default:e(()=>[i[4]||(i[4]=s("div",null,"Resoluci\xF3n aviso",-1)),t(z),B((v(),Q(se,{dense:"",flat:"",icon:"close"},{default:e(()=>[t(M,null,{default:e(()=>i[3]||(i[3]=[C("Cerrar")])),_:1})]),_:1})),[[de]])]),_:1}),t(j,{class:"scroll"},{default:e(()=>[s("div",Pe,d(y.value.codigo),1),t(D),t(re,{align:"left",dense:""},{default:e(()=>[(v(!0),x(S,null,P(T.value,(o,q)=>(v(),Q(le,{key:q,color:o.completado?"green":"grey",icon:o.completado?"check_circle":"hourglass_empty"},oe({subtitle:e(()=>[i[5]||(i[5]=s("div",{class:"text-body1"},null,-1)),C(d(o.titulo),1)]),default:e(()=>[s("div",Ve,d(o.descripcion),1),o.id==="P"&&o.informes?(v(),x("div",Ie,[t(ce,{"expand-separator":"","default-opened":"",label:"informes t\xE9cnico",class:"expansor"},{default:e(()=>[(v(!0),x(S,null,P(o.informes,(A,U)=>(v(),x("div",{key:U,class:"elemento-informe"},[s("p",Ne,d(A.tecnico+" - "+A.fin),1),s("p",$e,d(A.informe),1)]))),128))]),_:2},1024)])):L("",!0)]),_:2},[o.fecha!="-"?{name:"title",fn:e(()=>[s("div",Se,d(o.fecha),1)]),key:"0"}:void 0]),1032,["color","icon"]))),128))]),_:1})]),_:1}),t(j,null,{default:e(()=>[t(D)]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};var Ye=I(qe,[["__scopeId","data-v-2999be26"]]);export{Ye as default};
