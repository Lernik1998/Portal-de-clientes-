import{Q as M}from"./QList.7dac5c91.js";import{Q as D}from"./QSpace.5039b404.js";import{Q as U,a as L}from"./QBar.f6cb8648.js";import{bq as O,cI as z,aT as g,ab as $,bo as a,f as e,ak as b,W as c,ae as s,ad as H,ac as J,r as i,c as C,c6 as Y,cl as Z,c7 as B,c4 as G,cj as K,o as X,a as aa,cc as ea,aZ as ta,F as la,c8 as S,cb as j}from"./index.fe61ee2b.js";import{Q as oa}from"./QPage.e3a32904.js";import{u as sa}from"./use-quasar.6e3d8175.js";import{d as ra,e as na,a as ia}from"./format.759a650d.js";import{Q as ua}from"./QPagination.7bf5b5ea.js";import{Q as y,a as ca}from"./QTable.6ec200bc.js";import{_ as R}from"./plugin-vue_export-helper.21dcd24c.js";import{T as da}from"./TablaDetalleFactura.77cbb4cd.js";import"./QSelect.27ff7cce.js";const ma={class:"text-caption"},pa={key:0,class:"text-caption"},fa={class:"text-caption"},va={class:"text-caption"},ga={class:"text-caption"},ba={__name:"TarjetaFactura",props:{factura:{type:Object,required:!0}},setup(n){return(x,f)=>O((g(),$(ia,{clickable:""},{default:a(()=>[e(ra,null,{default:a(()=>[e(na,null,{default:a(()=>[b(c(n.factura.numero),1)]),_:1}),s("span",ma,c(n.factura.fecha),1),n.factura.estado!=""?(g(),H("span",pa,"Estado pago: "+c(n.factura.estado),1)):J("",!0),s("span",fa,"BASE: "+c(n.factura.base),1),s("span",va,"IVA: "+c(n.factura.iva),1),s("span",ga,"Total: "+c(n.factura.total),1)]),_:1})]),_:1})),[[z]])}};const _a={class:"row justify-center q-mt-md",style:{width:"100%"}},wa=["onClick"],ha={__name:"TablaFacturas",props:{items:{type:Array,required:!0}},emits:["abrir","imprimir"],setup(n,{emit:x}){const f=i(""),_=n,m=x,Q=i(0),w=C(()=>{switch(console.log(_.items),Q.value){}return _.items}),p=i({sortBy:"desc",descending:!1,page:1,rowsPerPage:15}),v=C(()=>Math.ceil(w.value.length/p.value.rowsPerPage)),h=u=>{m("abrir",u)},F=u=>{m("imprimir",u)},k=[{name:"cod",label:"C\xF3digo",field:"numero",align:"center"},{name:"fch",label:"Fecha",field:"fecha",align:"center"},{name:"hor",label:"Hora",field:"hora",align:"center"},{name:"base",label:"Base",field:"base",align:"center"},{name:"iva",label:"IVA",field:"iva",align:"center"},{name:"tot",label:"Total",field:"total",align:"center"},{name:"ver"},{name:"pdf"}];return(u,d)=>(g(),$(ca,{rows:w.value,columns:k,"row-key":"name",filter:f.value,pagination:p.value,"onUpdate:pagination":d[2]||(d[2]=l=>p.value=l),"no-data-label":"No hay datos para mostrar.","hide-pagination":"",flat:"",class:"tabla"},{"top-right":a(()=>[e(D),e(Y,{dense:"",debounce:"300",color:"primary",modelValue:f.value,"onUpdate:modelValue":d[0]||(d[0]=l=>f.value=l)},{append:a(()=>[e(Z,{name:"search"})]),_:1},8,["modelValue"])]),bottom:a(()=>[s("div",_a,[e(ua,{modelValue:p.value.page,"onUpdate:modelValue":d[1]||(d[1]=l=>p.value.page=l),"direction-links":"",color:"grey-8","active-color":"primary",flat:"",max:v.value},null,8,["modelValue","max"])])]),"body-cell-base":a(l=>[e(y,{props:l},{default:a(()=>[b(c(l.row.base.toFixed(2)),1)]),_:2},1032,["props"])]),"body-cell-iva":a(l=>[e(y,{props:l},{default:a(()=>[b(c(l.row.iva.toFixed(2)),1)]),_:2},1032,["props"])]),"body-cell-total":a(l=>[e(y,{props:l},{default:a(()=>[b(c(l.row.total.toFixed(2)),1)]),_:2},1032,["props"])]),"body-cell-ver":a(l=>[e(y,{style:{"max-width":"50px"}},{default:a(()=>[s("button",{class:"boton-tabla azul",onClick:T=>h(l.row)},"Detalles",8,wa)]),_:2},1024)]),"body-cell-pdf":a(l=>[e(y,{style:{"max-width":"50px"}},{default:a(()=>[e(B,{unelevated:"",class:"boton-tabla gris",icon:"print",onClick:T=>F(l.row)},null,8,["onClick"])]),_:2},1024)]),_:1},8,["rows","filter","pagination"]))}};var ya=R(ha,[["__scopeId","data-v-2c470b32"]]);const xa={id:"tabla-facturas"},Qa={id:"lista-facturas"},Fa=["src"],ka={__name:"FacturasPage",setup(n){const x=G(),f=K(),_=sa(),m=i([]),Q=i(0),w=i(20),p=i(1),v=i(!1),h=i(null),F=C(()=>h.value!==null),k=C(()=>u.value!==0),u=i(0),d=async()=>{if(!v.value){_.loading.show(),v.value=!0;try{const o=await ea.get("/facturas.php",{withCredentials:!0});o.data.success&&(Q.value=o.data.message.total,m.value=o.data.message.facturas.sort((t,r)=>{const N=V=>{const[P,I,W]=V.split("/");return new Date(`${W}-${I}-${P}`)},q=V=>{const[P,I]=V.split(":");return new Date(1970,0,1,P,I)},A=N(r.fecha)-N(t.fecha);return A!==0?A:q(r.hora)-q(t.hora)})),console.log("Facturas: ",m.value)}catch(o){console.log("Error:",o)}v.value=!1,_.loading.hide()}},l=o=>{JSON.stringify(o),x.push(f.path+"/"+o.id)},T=o=>{console.log(o),u.value=o.id},E=()=>{const o=window.scrollY+window.innerHeight,t=document.documentElement.scrollHeight;!v.value&&o>=t-10&&w.value<=Q.value&&(p.value+=1,w.value+=20,cargarAvisos())};return X(()=>{window.innerWidth<820&&window.addEventListener("scroll",E),d()}),aa(()=>{window.innerWidth<820&&window.removeEventListener("scroll",E)}),(o,t)=>(g(),$(oa,{class:"q-pa-md"},{default:a(()=>[t[8]||(t[8]=s("div",{class:"cabecera"},[s("span",{class:"text-h6"},"Facturas"),s("span",{class:"text-subtitle2"},"Consulte todas sus facturas")],-1)),s("div",xa,[e(ya,{items:m.value,onAbrir:l,onImprimir:T},null,8,["items"])]),s("div",Qa,[e(M,{bordered:"",separator:""},{default:a(()=>[(g(!0),H(la,null,ta(m.value,r=>(g(),$(ba,{key:r.numero,factura:r},null,8,["factura"]))),128))]),_:1})]),e(j,{"model-value":F.value,"onUpdate:modelValue":t[1]||(t[1]=r=>F.value=r),"full-width":""},{default:a(()=>[e(S,null,{default:a(()=>[e(U,null,{default:a(()=>[t[5]||(t[5]=s("div",null,null,-1)),e(D),e(B,{dense:"",flat:"",icon:"close",onClick:t[0]||(t[0]=r=>h.value=null)},{default:a(()=>[e(L,null,{default:a(()=>t[4]||(t[4]=[b("Cerrar")])),_:1})]),_:1})]),_:1}),e(da,{items:h.value},null,8,["items"])]),_:1})]),_:1},8,["model-value"]),e(j,{persistent:"","model-value":k.value,"onUpdate:modelValue":t[3]||(t[3]=r=>k.value=r),"full-width":""},{default:a(()=>[e(S,null,{default:a(()=>[e(U,null,{default:a(()=>[t[7]||(t[7]=s("div",null,null,-1)),e(D),e(B,{dense:"",flat:"",icon:"close",onClick:t[2]||(t[2]=r=>u.value=0)},{default:a(()=>[e(L,null,{default:a(()=>t[6]||(t[6]=[b("Cerrar")])),_:1})]),_:1})]),_:1}),s("embed",{type:"application/pdf",src:"https://apiclientes.fernandomoll.es/facturas.php?id="+u.value+"&pdf=true",width:"100%",height:"700"},null,8,Fa)]),_:1})]),_:1},8,["model-value"])]),_:1}))}};var Ua=R(ka,[["__scopeId","data-v-0bd9db1e"]]);export{Ua as default};
